<!DOCTYPE html>
<html lang="zxx" class="no-js" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragment/fragment :: html_head"/>
<style>
    .product-thumbnail {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    .product-name {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .product-price {
        font-size: 1.25rem;
        color: #e63946;
    }

    .quantity-display {
        display: flex;
        align-items: center;
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .quantity-display span {
        font-weight: bold;
    }

    .product-form {
        display: flex;
        flex-direction: column;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-control {
        width: 100%;
        padding: 0.5rem;
        box-sizing: border-box;
    }

    .error-message {
        color: red;
        display: none;
    }

    .button-container {
        display: flex;
        gap: 1rem;
    }

    .primary-btn {
        background-color: #f1faee;
        border: none;
        padding: 0.5rem 1rem;
        cursor: pointer;
        font-size: 1rem;
    }

    .primary-btn svg {
        vertical-align: middle;
    }

    .description-area {
        background-color: rgba(153, 152, 152, 0.27);
        padding: 20px;
        margin-top: 20px;
    }

    .description-area h2 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .description-area p {
        font-size: 1rem;
        line-height: 1.5;
    }

</style>
</head>
<body>
<header th:replace="fragment/header:: header"/>

<!-- Start Banner Area -->
<section class="banner-area organic-breadcrumb">
    <div class="container">
        <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
            <div class="col-first">
                <h1 style="font-weight: 600;color: #ff9933;">Thông tin sản phẩm</h1>
                <nav class="d-flex align-items-center">
                    <a>Trang chủ<span class="lnr lnr-arrow-right"></span> Cửa hàng <span
                            class="lnr lnr-arrow-right"></span> Danh sách sản phẩm <span
                            class="lnr lnr-arrow-right"></span> Thông tin sản phẩm</a>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- End Banner Area -->

<!--================Single Product Area =================-->
<div class="container">
    <div class="row">
        <!-- Ảnh sản phẩm -->
        <div class="col-lg-7">
            <img class="product-thumbnail" th:src="@{${product.thumbnail}}" alt="thumbnail"/>
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="s_product_text col-lg-5">
            <h6 class="product-name" th:text="${product.name}"></h6>
            <h2 class="productPrice" name="productPrice" id="productPrice" th:utext="${#numbers.formatDecimal(productDetail.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></h2>

            <div class="quantity-display">
                <span>Số lượng:</span>
                <span id="quantityDisplay" name="quantityDisplay" th:text="${productDetail.quantity}"></span>
            </div>

            <form id="productForm" method="post" class="product-form">
                <div class="form-group">
                    <label for="size">Size: </label>
                    <select id="size" name="sizeId" class="form-control" onchange="updateQuantity()">
                        <option th:each="item : ${listSize}"
                                th:value="${item.id}"
                                th:text="${item.sizeNumber}"
                                th:selected="${item.id == productDetail.size.id}">
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="color">Color: </label>
                    <select id="color" name="colorId" class="form-control" onchange="updateQuantity()">
                        <option th:each="item : ${listColor}"
                                th:value="${item.id}"
                                th:text="${item.nameColor}"
                                th:selected="${item.id == productDetail.color.id}">
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="quantity">Số lượng:</label>
                    <input type="number" min="1" name="quantity" id="quantity" class="form-control"
                           th:value="1" title="Quantity:"/>
                    <span id="quantityError" name="quantityError" class="error-message"></span>
                </div>
                <input type="hidden" name="proId" th:value="${product.id}">

                <div class="button-container">
                    <!-- Nút Thêm vào giỏ hàng -->
                    <button type="button" class="primary-btn" onclick="submitForm('/add-cart')">
                        <!-- SVG for cart icon with plus sign -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cart-plus" viewBox="0 0 16 16">
                            <path d="M5.5 1a.5.5 0 0 1 .5.5v.5h7a.5.5 0 0 1 .5.5v.5h1.5a.5.5 0 0 1 .493.6l-1.5 6a.5.5 0 0 1-.492.4H4.5a.5.5 0 0 1-.492-.4l-1.5-6A.5.5 0 0 1 2 2H.5A.5.5 0 0 1 0 1.5v-.5A.5.5 0 0 1 .5 1h5zM1 2h.5L2 8h10l.5-6H1.5L1 2zm4.5 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0zm7 0a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0z"/>
                            <path d="M12 5v6m-3-3h6"/>
                        </svg>
                        Thêm
                    </button>

                    <!-- Nút Mua ngay -->
                    <button type="button" class="primary-btn" onclick="submitForm('/buy-now')">
                        <!-- SVG for buy now icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cart-check" viewBox="0 0 16 16">
                            <path d="M8 0a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H7a.5.5 0 0 1-.5-.5V.5A.5.5 0 0 1 7 0h1zM7 6v5a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V6h4zM13.5 2h-11a.5.5 0 0 0-.5.5v.5a.5.5 0 0 0 .5.5h.66l.665 4.7L4.663 10.6a.5.5 0 0 0-.355.447l-.083.91a.5.5 0 0 0 .358.522l.062.023c.228.088.44.197.637.33.22.156.433.3.648.345.928.037.272.016.527.076.765.095.415.157.662.158.778a.5.5 0 0 0-.263.7l.065.168a.5.5 0 0 0 .7.262l.056-.042c.252-.182.504-.368.74-.564.217-.179.43-.352.646-.529L13.5 3.82a.5.5 0 0 0 .327-.476V2.5a.5.5 0 0 0-.5-.5z"/>
                        </svg>
                        Mua
                    </button>
                </div>


            </form>
        </div>
    </div>
</div>
<!--================End Single Product Area =================-->

<!--================Product Description Area =================-->
<div class="description-area container">
    <h2>Mô tả chi tiết sản phẩm</h2>
    <p th:utext="${product.description}"></p>
</div>
<!--================End Product Description Area =================-->

<footer th:replace="fragment/footer :: footer" style="width: 100%;"></footer>

<script src="js/vendor/jquery-2.2.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
<script src="js/vendor/bootstrap.min.js"></script>
<script src="js/jquery.ajaxchimp.min.js"></script>
<script src="js/jquery.nice-select.min.js"></script>
<script src="js/jquery.sticky.js"></script>
<script src="js/nouislider.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<!--gmaps Js-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
<script src="js/gmaps.min.js"></script>
<script src="js/main.js"></script>
<script>
    function submitForm(action) {
        if (validateQuantity()==true) {
            var form = document.getElementById('productForm');
            form.action = action;
            form.submit();
        }
    }

    function getProductIdFromUrl() {
        const pathParts = window.location.pathname.split('/');
        return pathParts[pathParts.length - 1];
    }

    function updateQuantity() {
        var sizeId = document.getElementById("size").value;
        var colorId = document.getElementById("color").value;
        var productId = getProductIdFromUrl(); // Extract productId from URL

        if (sizeId && colorId && productId) {
            fetch(`/product-detail/quantity?sizeId=${sizeId}&colorId=${colorId}&productId=${productId}`)
                .then(response1 => response1.json())
                .then(data => {
                    // Reset quantity input to 1 and update the displayed quantity
                    document.getElementById("quantity").value = 1;
                    var quantityDisplayElement = document.getElementById("quantityDisplay");
                    if (quantityDisplayElement) {
                        quantityDisplayElement.innerHTML = data.quantity;
                    } else {
                        console.error("Quantity display element not found.");
                    }
                })
            fetch(`/product-detail/price?sizeId=${sizeId}&colorId=${colorId}&productId=${productId}`)
                .then(response => response.json())
                .then(data => {
                    // Định dạng lại giá theo kiểu số với dấu phẩy
                    const formattedPrice = new Intl.NumberFormat('vi-VN', {
                        style: 'decimal',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    }).format(data.price);

                    // Cập nhật giá hiển thị trong phần tử h2 và thêm "VNĐ"
                    var priceElement = document.getElementById("productPrice");
                    if (priceElement) {
                        priceElement.innerHTML = formattedPrice + ' VNĐ';
                    } else {
                        console.error("Price display element not found.");
                    }
                })
                .catch(error => console.error('Error fetching quantity:', error));
        }
    }


    function validateQuantity() {
        var maxQuantity = parseInt(document.getElementById('quantityDisplay').textContent)
        var inputQuantity = document.getElementById('quantity').value;

        var errorElement = document.getElementById('quantityError');
        if (parseInt(inputQuantity) > parseInt(maxQuantity)) {
            errorElement.innerHTML = "Số lượng vượt quá số lượng sản phẩm có sẵn!";
            errorElement.style.display = "inline"; // Hiển thị thông báo lỗi
            return false; // Ngăn không cho form gửi đi
        }
        else {
            errorElement.style.display = "none"; // Ẩn thông báo lỗi nếu nhập đúng
        }
        if(parseInt(inputQuantity) <= 0){
            errorElement.textContent = "Số lượng phải lớn hơn 0";
            errorElement.style.display = "inline"; // Hiển thị thông báo lỗi
            return false; // Ngăn không cho form gửi đi
        }else{
            errorElement.style.display = "none"; // Ẩn thông báo lỗi nếu nhập đúng
        }
        if (!inputQuantity || inputQuantity.trim() === "") {
            errorElement.textContent = "Số lượng không được để trống";
            errorElement.style.display = "inline";
            return false;
        }
        else {
            errorElement.style.display = "none";
            return true;
        }

        // return true; // Allow form submission
    }
</script>
</body>
</html>
